---
phase: 03-static-pages-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/privacy.astro
  - tests/privacy.spec.ts
  - playwright.config.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "User can access /privacy and see privacy policy content"
    - "Page has unique title 'Privacy Policy | NomadCrew' in browser tab"
    - "Meta description appears in page source with privacy policy summary"
    - "Canonical URL points to https://nomadcrew.uk/privacy"
    - "Page renders with same styling as React version"
  artifacts:
    - path: "src/pages/privacy.astro"
      provides: "Privacy policy page with SEO meta tags"
      min_lines: 60
    - path: "tests/privacy.spec.ts"
      provides: "Visual regression and meta tag tests"
      exports: []
    - path: "playwright.config.ts"
      provides: "Playwright configuration for visual testing"
      min_lines: 15
  key_links:
    - from: "src/pages/privacy.astro"
      to: "src/layouts/BaseLayout.astro"
      via: "import and component usage"
      pattern: "import BaseLayout from.*BaseLayout.astro"
    - from: "src/pages/privacy.astro"
      to: "SEO meta tags"
      via: "props to BaseLayout"
      pattern: "<BaseLayout title=.*description="
---

<objective>
Migrate Privacy Policy page from React to Astro and validate SEO implementation

Purpose: This is the first real content page migration, validating that the Astro setup from Phase 1-2 works correctly for actual user-facing content. Success here proves the deployment pipeline and establishes patterns for future page migrations.

Output: Working privacy page at /privacy with correct SEO meta tags, visual regression tests, and deployment verification
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-static-pages-migration/03-RESEARCH.md
@src/layouts/BaseLayout.astro
@src/PrivacyPolicy.tsx
@astro.config.mjs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Privacy Policy Astro Page</name>
  <files>src/pages/privacy.astro</files>
  <action>
Convert src/PrivacyPolicy.tsx to src/pages/privacy.astro:

1. Create frontmatter with:
   - Import BaseLayout from '../layouts/BaseLayout.astro'
   - Define title = "Privacy Policy"
   - Define description = "Privacy policy for NomadCrew mobile app covering data collection, usage, and your rights."
   - Define effectiveDate = "2024-12-28"

2. Wrap content in BaseLayout with title and description props

3. Convert React JSX to Astro template:
   - Change all className to class
   - Remove export default function wrapper
   - Keep all content sections exactly as in React version
   - Preserve dark: classes for future dark mode
   - Use {effectiveDate} for date interpolation

4. Preserve all existing content:
   - Introduction paragraph
   - Information Collection and Use section
   - Location Data section
   - Third Party Services section with external links
   - Contact Us section with email link
   - Footer with generator attribution

Do NOT:
- Add client directives (this is static content)
- Change link URLs (external links stay as-is)
- Modify styling classes
  </action>
  <verify>
1. Run: pnpm run dev
2. Visit http://localhost:4321/privacy
3. Page displays with correct content and styling
4. View source (Ctrl+U): verify title contains "Privacy Policy | NomadCrew"
5. View source: verify meta description contains "Privacy policy for NomadCrew"
6. View source: verify canonical URL href contains "/privacy"
7. Run: pnpm run build (no errors)
  </verify>
  <done>
Privacy page accessible at /privacy with:
- Title: "Privacy Policy | NomadCrew"
- Meta description present in source
- Canonical URL pointing to /privacy
- All content sections visible and styled correctly
  </done>
</task>

<task type="auto">
  <name>Task 2: Set Up Playwright Visual Regression Tests</name>
  <files>playwright.config.ts, tests/privacy.spec.ts, package.json</files>
  <action>
1. Install Playwright:
   - Run: pnpm add -D @playwright/test
   - Run: pnpm exec playwright install chromium (only need one browser for visual tests)

2. Create playwright.config.ts at project root:
   ```typescript
   import { defineConfig, devices } from '@playwright/test';

   export default defineConfig({
     testDir: './tests',
     fullyParallel: true,
     forbidOnly: !!process.env.CI,
     retries: process.env.CI ? 2 : 0,
     workers: process.env.CI ? 1 : undefined,
     reporter: 'html',
     use: {
       baseURL: 'http://localhost:4321',
       trace: 'on-first-retry',
     },
     projects: [
       {
         name: 'chromium',
         use: { ...devices['Desktop Chrome'] },
       },
     ],
     webServer: {
       command: 'pnpm run dev',
       url: 'http://localhost:4321',
       reuseExistingServer: !process.env.CI,
     },
   });
   ```

3. Create tests/privacy.spec.ts:
   ```typescript
   import { test, expect } from '@playwright/test';

   test.describe('Privacy Policy Page', () => {
     test('renders with correct content', async ({ page }) => {
       await page.goto('/privacy');
       await page.waitForLoadState('networkidle');

       // Verify heading
       await expect(page.locator('h1')).toContainText('Privacy Policy');

       // Verify key sections exist
       await expect(page.locator('text=Information Collection')).toBeVisible();
       await expect(page.locator('text=Location Data')).toBeVisible();
       await expect(page.locator('text=Third Party Services')).toBeVisible();
       await expect(page.locator('text=Contact Us')).toBeVisible();
     });

     test('has correct SEO meta tags', async ({ page }) => {
       await page.goto('/privacy');

       // Verify title
       await expect(page).toHaveTitle(/Privacy Policy.*NomadCrew/);

       // Verify meta description
       const description = await page.locator('meta[name="description"]').getAttribute('content');
       expect(description).toContain('Privacy policy for NomadCrew');

       // Verify canonical URL
       const canonical = await page.locator('link[rel="canonical"]').getAttribute('href');
       expect(canonical).toContain('/privacy');
     });

     test('visual regression - full page', async ({ page }) => {
       await page.goto('/privacy');
       await page.waitForLoadState('networkidle');

       // Wait for fonts
       await page.evaluate(() => document.fonts.ready);

       // Disable animations for consistent screenshots
       await page.addStyleTag({
         content: `*, *::before, *::after {
           animation-duration: 0s !important;
           transition-duration: 0s !important;
         }`
       });

       await expect(page).toHaveScreenshot('privacy-page.png', {
         fullPage: true,
         maxDiffPixelRatio: 0.01,
       });
     });
   });
   ```

4. Add test script to package.json:
   - Add: "test": "playwright test"
   - Add: "test:ui": "playwright test --ui"
  </action>
  <verify>
1. Run: pnpm test
2. All 3 tests pass (content, meta tags, visual)
3. Visual baseline screenshot created at tests/privacy.spec.ts-snapshots/
4. Run: pnpm test again to verify snapshot matches
  </verify>
  <done>
Playwright configured with:
- 3 passing tests for privacy page
- Visual regression baseline established
- Test script available via pnpm test
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify Production Build and Deployment</name>
  <files>dist/privacy/index.html</files>
  <action>
1. Build for production:
   - Run: pnpm build
   - Verify dist/privacy/index.html exists
   - Check file contains correct meta tags

2. Test production build locally:
   - Run: pnpm preview
   - Visit http://localhost:4321/privacy
   - Verify page renders correctly
   - View source: confirm meta tags present

3. Deploy to Cloudflare Pages preview:
   - Run: pnpm exec wrangler pages deploy dist --project-name=nomadcrew-landing-page
   - Note the preview URL
   - Visit preview URL + /privacy
   - Verify page accessible and renders correctly
   - View source on deployed page: confirm canonical URL is correct

4. Verify SEO requirements met:
   - SEO-01: Unique title and description (confirmed in source)
   - SEO-04: Canonical URL correct (confirmed in source)
  </action>
  <verify>
1. dist/privacy/index.html exists after build
2. Local preview at http://localhost:4321/privacy works
3. Cloudflare preview deployment successful
4. /privacy accessible on deployed site
5. View source shows correct title, description, and canonical
  </verify>
  <done>
Production deployment verified:
- Build succeeds with privacy page in output
- Local preview renders correctly
- Cloudflare preview deployment accessible
- SEO-01 and SEO-04 requirements satisfied
  </done>
</task>

</tasks>

<verification>
Overall phase verification:

1. **Page Access:**
   - http://localhost:4321/privacy renders correctly in dev
   - Production build includes dist/privacy/index.html
   - Deployed preview URL + /privacy is accessible

2. **SEO Compliance:**
   - Title: "Privacy Policy | NomadCrew" (view source)
   - Description: Contains "Privacy policy for NomadCrew" (view source)
   - Canonical: Points to https://nomadcrew.uk/privacy (view source)

3. **Visual Parity:**
   - Playwright visual test passes
   - Content matches React version
   - Styling preserved (Tailwind classes working)

4. **Tests Pass:**
   - pnpm test runs all 3 tests successfully
   - No regressions after re-running
</verification>

<success_criteria>
Phase 3 is complete when:
1. Privacy policy page accessible at /privacy with correct content
2. Page displays unique title and meta description in browser view source
3. Canonical URL meta tag present and correct in page source
4. Page renders identically to React version (visual regression test passes)
5. Deployment to Cloudflare Pages preview succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/03-static-pages-migration/03-01-SUMMARY.md`
</output>
