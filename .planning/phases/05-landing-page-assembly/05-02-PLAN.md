---
phase: 05-landing-page-assembly
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/layouts/BaseLayout.astro
  - src/pages/test-json-ld.astro
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Homepage includes JSON-LD Organization schema"
    - "Homepage includes JSON-LD WebSite schema"
    - "Google Rich Results Test validates both schemas"
  artifacts:
    - path: "src/layouts/BaseLayout.astro"
      provides: "JSON-LD structured data injection"
      contains: "application/ld+json"
      exports: ["organizationSchema", "websiteSchema"]
  key_links:
    - from: "src/layouts/BaseLayout.astro"
      to: "JSON-LD scripts"
      via: "set:html directive in head"
      pattern: "type=\"application/ld\\+json\""
---

<objective>
Add JSON-LD Organization and WebSite schemas to BaseLayout.astro

Purpose: Satisfy SEO-07 (Organization schema) and SEO-08 (WebSite schema) requirements for rich search results
Output: BaseLayout.astro with conditional JSON-LD injection for homepage
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/layouts/BaseLayout.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add JSON-LD schemas to BaseLayout</name>
  <files>src/layouts/BaseLayout.astro</files>
  <action>
Update src/layouts/BaseLayout.astro to include JSON-LD Organization and WebSite schemas.

Add new prop `isHomepage` (optional, defaults false) to control schema injection - only homepage needs these schemas.

Updated BaseLayout.astro structure:

```astro
---
// src/layouts/BaseLayout.astro
import '../styles/global.css';

interface Props {
  title: string;
  description: string;
  ogImage?: string;
  isHomepage?: boolean;
}

const {
  title,
  description,
  ogImage = 'https://nomadcrew.uk/og-image.jpg',
  isHomepage = false,
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const siteUrl = Astro.site?.toString() || 'https://nomadcrew.uk';

// JSON-LD Organization Schema (SEO-07)
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "NomadCrew",
  "url": siteUrl,
  "logo": `${siteUrl}/og-image.jpg`,
  "description": "Group travel coordination app for digital nomads and remote workers",
  "sameAs": []
};

// JSON-LD WebSite Schema (SEO-08)
// Note: potentialAction (SearchAction) omitted per research - no search functionality in Phase 5
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "NomadCrew",
  "url": siteUrl,
  "description": description
};
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <meta name="generator" content={Astro.generator} />

    <!-- SEO Meta Tags -->
    <title>{title} | NomadCrew</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />

    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:site_name" content="NomadCrew" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />

    <!-- JSON-LD Structured Data (homepage only) -->
    {isHomepage && (
      <>
        <script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />
        <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
      </>
    )}
  </head>
  <body class="min-h-screen bg-white text-gray-900 antialiased">
    <slot />
  </body>
</html>
```

Key additions:
1. `isHomepage` prop (optional boolean, defaults to false)
2. `organizationSchema` object with @context, @type, name, url, logo, description
3. `websiteSchema` object with @context, @type, name, url, description
4. Conditional rendering: schemas only injected when isHomepage=true
5. Added og:image:width and og:image:height meta tags (1200x630)

Do NOT add SearchAction to WebSite schema - no search functionality exists yet (deferred to Phase 7).
  </action>
  <verify>
```bash
# Verify TypeScript compiles
pnpm run check

# Verify schema script tags in template
grep -n "application/ld+json" src/layouts/BaseLayout.astro

# Verify isHomepage prop
grep -n "isHomepage" src/layouts/BaseLayout.astro

# Verify og:image dimensions are present
grep -n "og:image:width" src/layouts/BaseLayout.astro
grep -n "og:image:height" src/layouts/BaseLayout.astro
```
  </verify>
  <done>BaseLayout.astro includes JSON-LD Organization and WebSite schemas, conditionally rendered when isHomepage=true, og:image dimensions included, TypeScript check passes</done>
</task>

<task type="auto">
  <name>Task 2: Create test page to verify JSON-LD conditional rendering</name>
  <files>src/pages/test-json-ld.astro</files>
  <action>
Create a temporary test page that sets isHomepage=true to verify JSON-LD schemas actually render in HTML output.

```astro
---
// src/pages/test-json-ld.astro
// Temporary page to verify JSON-LD conditional rendering
// This page will be removed after verification or kept for debugging
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout
  title="JSON-LD Test"
  description="Test page for JSON-LD schema verification"
  isHomepage={true}
>
  <main class="p-8">
    <h1 class="text-2xl font-bold">JSON-LD Test Page</h1>
    <p>This page has isHomepage=true to test JSON-LD schema rendering.</p>
    <p>View page source to verify:</p>
    <ul class="list-disc ml-6 mt-4">
      <li>Organization schema with @type: "Organization"</li>
      <li>WebSite schema with @type: "WebSite"</li>
      <li>og:image:width = 1200</li>
      <li>og:image:height = 630</li>
    </ul>
  </main>
</BaseLayout>
```

This page enables verification that:
1. JSON-LD scripts appear in HTML when isHomepage=true
2. Both Organization and WebSite schemas are present
3. The conditional rendering logic works correctly
  </action>
  <verify>
```bash
# Start dev server
pnpm run dev &
DEV_PID=$!
sleep 4

# Verify JSON-LD renders in actual HTML output
echo "=== Checking JSON-LD in HTML output ==="
curl -s http://localhost:4321/test-json-ld/ | grep -o "application/ld+json" | wc -l
# Expected: 2 (Organization + WebSite)

# Verify Organization schema content
echo "=== Checking Organization schema ==="
curl -s http://localhost:4321/test-json-ld/ | grep -o '"@type":"Organization"' || echo "Organization schema present"

# Verify WebSite schema content
echo "=== Checking WebSite schema ==="
curl -s http://localhost:4321/test-json-ld/ | grep -o '"@type":"WebSite"' || echo "WebSite schema present"

# Verify og:image dimensions in HTML
echo "=== Checking OG image dimensions ==="
curl -s http://localhost:4321/test-json-ld/ | grep 'og:image:width' | head -1
curl -s http://localhost:4321/test-json-ld/ | grep 'og:image:height' | head -1

# Verify non-homepage doesn't have schemas
echo "=== Checking non-homepage (privacy) has no schemas ==="
curl -s http://localhost:4321/privacy/ | grep -o "application/ld+json" | wc -l
# Expected: 0

kill $DEV_PID 2>/dev/null || true
```
  </verify>
  <done>test-json-ld.astro created, JSON-LD schemas verified rendering in HTML output with isHomepage=true, conditional logic confirmed working</done>
</task>

<task type="auto">
  <name>Task 3: Add Playwright test for JSON-LD schemas</name>
  <files>tests/seo.spec.ts</files>
  <action>
Create tests/seo.spec.ts to verify JSON-LD schemas render correctly on homepage.

```typescript
// tests/seo.spec.ts
import { test, expect } from '@playwright/test';

test.describe('SEO - JSON-LD Structured Data', () => {
  test.beforeEach(async ({ page }) => {
    // Hide Astro dev toolbar to avoid test interference
    await page.addInitScript(() => {
      localStorage.setItem('astro-dev-toolbar-hidden', 'true');
    });
  });

  test('homepage includes Organization schema', async ({ page }) => {
    await page.goto('/');

    // Find JSON-LD script tags
    const scripts = await page.locator('script[type="application/ld+json"]').all();
    expect(scripts.length).toBeGreaterThanOrEqual(1);

    // Parse and validate Organization schema
    let foundOrganization = false;
    for (const script of scripts) {
      const content = await script.textContent();
      if (content) {
        const schema = JSON.parse(content);
        if (schema['@type'] === 'Organization') {
          foundOrganization = true;
          expect(schema['@context']).toBe('https://schema.org');
          expect(schema.name).toBe('NomadCrew');
          expect(schema.url).toContain('nomadcrew');
        }
      }
    }
    expect(foundOrganization).toBe(true);
  });

  test('homepage includes WebSite schema', async ({ page }) => {
    await page.goto('/');

    const scripts = await page.locator('script[type="application/ld+json"]').all();

    let foundWebSite = false;
    for (const script of scripts) {
      const content = await script.textContent();
      if (content) {
        const schema = JSON.parse(content);
        if (schema['@type'] === 'WebSite') {
          foundWebSite = true;
          expect(schema['@context']).toBe('https://schema.org');
          expect(schema.name).toBe('NomadCrew');
        }
      }
    }
    expect(foundWebSite).toBe(true);
  });

  test('non-homepage pages do not include schemas', async ({ page }) => {
    await page.goto('/privacy');

    const scripts = await page.locator('script[type="application/ld+json"]').all();
    // Privacy page should have 0 JSON-LD scripts (isHomepage not set)
    expect(scripts.length).toBe(0);
  });

  test('OG meta tags have correct dimensions', async ({ page }) => {
    await page.goto('/');

    const ogWidth = await page.locator('meta[property="og:image:width"]').getAttribute('content');
    const ogHeight = await page.locator('meta[property="og:image:height"]').getAttribute('content');

    expect(ogWidth).toBe('1200');
    expect(ogHeight).toBe('630');
  });
});
```

Note: These tests will pass once index.astro sets isHomepage=true (Plan 03). For now, the tests verify the infrastructure is in place.
  </action>
  <verify>
```bash
# Verify test file created
ls -la tests/seo.spec.ts

# Note: Tests will be run after Plan 03 updates index.astro with isHomepage=true
# For now, just verify TypeScript compiles
pnpm run check
```
  </verify>
  <done>tests/seo.spec.ts created with 4 test cases for JSON-LD validation and OG dimensions</done>
</task>

</tasks>

<verification>
```bash
# TypeScript check
pnpm run check

# Verify schema code in layout
grep -A 5 "organizationSchema" src/layouts/BaseLayout.astro
grep -A 5 "websiteSchema" src/layouts/BaseLayout.astro

# Verify test page exists
ls -la src/pages/test-json-ld.astro

# Verify test file
ls -la tests/seo.spec.ts

# Full JSON-LD rendering verification (most critical)
pnpm run dev &
sleep 4
curl -s http://localhost:4321/test-json-ld/ | grep -c "application/ld+json"
# Expected: 2
kill %1 2>/dev/null
```
</verification>

<success_criteria>
1. BaseLayout.astro includes organizationSchema and websiteSchema objects
2. JSON-LD scripts conditionally render when isHomepage=true
3. og:image:width and og:image:height meta tags added (1200, 630)
4. test-json-ld.astro created and verifies JSON-LD renders in HTML output
5. tests/seo.spec.ts created with schema validation tests
6. TypeScript check passes: pnpm run check
</success_criteria>

<output>
After completion, create `.planning/phases/05-landing-page-assembly/05-02-SUMMARY.md`
</output>
