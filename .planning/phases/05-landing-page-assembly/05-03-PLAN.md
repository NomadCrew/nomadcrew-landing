---
phase: 05-landing-page-assembly
plan: 03
type: execute
wave: 2
depends_on: ["05-01", "05-02"]
files_modified:
  - src/pages/index.astro
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Landing page accessible at / with all sections visible"
    - "Navbar slides down on page load"
    - "Hero section displays with CTA button"
    - "Feature cards render in 4-column grid"
    - "Waitlist form accepts email input"
    - "Footer displays copyright"
    - "All interactive elements function (animations, mobile menu, scrolling)"
  artifacts:
    - path: "src/pages/index.astro"
      provides: "Complete landing page composition"
      min_lines: 60
      contains: "isHomepage={true}"
  key_links:
    - from: "src/pages/index.astro"
      to: "src/components/react/Navbar.tsx"
      via: "client:load directive"
      pattern: "Navbar client:load"
    - from: "src/pages/index.astro"
      to: "src/components/react/HeroSection.tsx"
      via: "client:idle directive"
      pattern: "HeroSection client:idle"
    - from: "src/pages/index.astro"
      to: "src/components/react/FeatureCard.tsx"
      via: "client:visible directive"
      pattern: "FeatureCard.*client:visible"
    - from: "src/pages/index.astro"
      to: "src/components/react/WaitlistForm.tsx"
      via: "client:visible directive"
      pattern: "WaitlistForm client:visible"
    - from: "src/pages/index.astro"
      to: "src/components/Footer.astro"
      via: "static import"
      pattern: "Footer"
---

<objective>
Compose the landing page by replacing index.astro with full page using all React islands

Purpose: Create the production landing page at / using verified React islands from Phase 4
Output: index.astro that renders complete landing page with Navbar, Hero, Features, Waitlist, and Footer
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-react-islands-extraction/04-04-SUMMARY.md
@src/pages/test-all-islands.astro
@src/layouts/BaseLayout.astro
</context>

<pre_verification>
Verify dependencies from Plan 05-01 and 05-02 are complete before proceeding:

```bash
# Check OG image exists (from Plan 05-01)
if [ ! -f "public/og-image.jpg" ]; then
  echo "ERROR: public/og-image.jpg not found. Plan 05-01 must complete first."
  echo "Run: /gsd:execute-plan 05-01"
  exit 1
fi

# Verify OG image is valid (not empty/corrupted)
OG_SIZE=$(stat -c%s "public/og-image.jpg" 2>/dev/null || stat -f%z "public/og-image.jpg" 2>/dev/null)
if [ "$OG_SIZE" -lt 1000 ]; then
  echo "ERROR: public/og-image.jpg appears invalid (size: $OG_SIZE bytes)"
  exit 1
fi
echo "OG image verified: public/og-image.jpg ($OG_SIZE bytes)"

# Check BaseLayout has JSON-LD schemas (from Plan 05-02)
if ! grep -q "organizationSchema" src/layouts/BaseLayout.astro; then
  echo "ERROR: BaseLayout.astro missing JSON-LD schemas. Plan 05-02 must complete first."
  echo "Run: /gsd:execute-plan 05-02"
  exit 1
fi
echo "BaseLayout JSON-LD schemas verified"

# Check BaseLayout has isHomepage prop
if ! grep -q "isHomepage" src/layouts/BaseLayout.astro; then
  echo "ERROR: BaseLayout.astro missing isHomepage prop. Plan 05-02 must complete first."
  exit 1
fi
echo "BaseLayout isHomepage prop verified"

echo "All dependencies verified. Proceeding with Plan 05-03."
```
</pre_verification>

<tasks>

<task type="auto">
  <name>Task 1: Replace index.astro with landing page composition</name>
  <files>src/pages/index.astro</files>
  <action>
First, run the pre_verification script above. If any check fails, stop and report which dependency is missing.

If all checks pass, replace src/pages/index.astro content with the full landing page composition.

Use test-all-islands.astro as the proven pattern (6 passing Playwright tests from Phase 4).

Key differences from test page:
1. Set isHomepage={true} to enable JSON-LD schemas
2. Update title and description for SEO
3. Add id="features" to features section for potential future navigation
4. Production-ready content (not "test" labels)

```astro
---
// src/pages/index.astro
// NomadCrew Landing Page - Astro with React Islands
import BaseLayout from '../layouts/BaseLayout.astro';
import Navbar from '../components/react/Navbar.tsx';
import HeroSection from '../components/react/HeroSection.tsx';
import FeatureCard from '../components/react/FeatureCard.tsx';
import WaitlistForm from '../components/react/WaitlistForm.tsx';
import Footer from '../components/Footer.astro';
---

<BaseLayout
  title="Group Travel, Simplified"
  description="Coordinate plans, share locations, manage expenses, and chat in real-time - all within a single, mobile-first app designed for modern group travel."
  isHomepage={true}
>
  <!-- Navbar: client:load (immediate interactivity for navigation) -->
  <Navbar client:load />

  <!-- HeroSection: client:idle (animations deferred until browser idle) -->
  <HeroSection client:idle />

  <!-- Features Section: client:visible (hydrate when scrolled into view) -->
  <section id="features" class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
        <FeatureCard
          client:visible
          icon="ClipboardList"
          title="Trip Planning & Management"
          description="Plan, manage, and collaborate on group trips with destination search and shared tools."
        />
        <FeatureCard
          client:visible
          icon="MessagesSquare"
          title="Real-time Communication"
          description="Stay connected with group chat, real-time messaging, media sharing, and read receipts."
        />
        <FeatureCard
          client:visible
          icon="LocateFixed"
          title="Location Services"
          description="Share live locations, explore interactive maps, and discover nearby places together."
        />
        <FeatureCard
          client:visible
          icon="Banknote"
          title="Financial Management"
          description="Track expenses effortlessly and split costs fairly among your travel group."
        />
      </div>
    </div>
  </section>

  <!-- Waitlist Section: client:visible (below-fold, deferred hydration) -->
  <section id="waitlist" class="py-16 px-4">
    <div class="container mx-auto max-w-xl text-center">
      <h2 class="text-3xl font-bold mb-6">Join the Waitlist</h2>
      <p class="text-gray-600 mb-8">
        Be among the first to experience a better way to travel together.
        Get early access and exclusive updates.
      </p>
      <WaitlistForm client:visible />
    </div>
  </section>

  <!-- Footer: Static Astro component (zero JavaScript) -->
  <Footer />
</BaseLayout>
```

Hydration strategy (verified in Phase 4):
- Navbar: client:load - navigation needs immediate interactivity
- HeroSection: client:idle - animations are nice-to-have, not critical
- FeatureCard: client:visible - below fold, only hydrate when scrolled into view
- WaitlistForm: client:visible - below fold, only hydrate when user scrolls to it
- Footer: static - no JavaScript needed
  </action>
  <verify>
```bash
# Verify file updated
head -30 src/pages/index.astro

# Verify isHomepage is set
grep "isHomepage={true}" src/pages/index.astro

# Verify all imports present
grep -E "import.*(Navbar|HeroSection|FeatureCard|WaitlistForm|Footer)" src/pages/index.astro

# TypeScript check
pnpm run check

# Start dev server and verify page loads
pnpm run dev &
sleep 3
curl -s http://localhost:4321/ | grep -o "NomadCrew" | head -1
kill %1
```
  </verify>
  <done>index.astro replaced with full landing page composition using all React islands, isHomepage={true} set for JSON-LD, OG image dependency verified</done>
</task>

<task type="auto">
  <name>Task 2: Run existing Playwright tests and SEO tests</name>
  <files>None (test execution only)</files>
  <action>
Run all Playwright tests to verify landing page works correctly.

Tests to run:
1. `tests/islands.spec.ts` - Existing hydration tests (6 tests from Phase 4)
2. `tests/seo.spec.ts` - New JSON-LD tests (4 tests from Plan 02)

The islands tests should pass on / since it now has the same structure as test-all-islands.astro.

Note: Some tests reference /test-all-islands/ specifically. The new index page at / should also pass the same checks.

```bash
# Run all Playwright tests
pnpm run test

# If any failures, check specific test output
pnpm run test --reporter=list
```

Expected: All tests pass (islands hydration + SEO schemas)
  </action>
  <verify>
```bash
# Run full test suite
pnpm run test

# Check exit code
echo "Exit code: $?"
# Should be 0
```
  </verify>
  <done>All Playwright tests pass (islands.spec.ts + seo.spec.ts), landing page verified functional</done>
</task>

<task type="auto">
  <name>Task 3: Verify bundle size under 150KB gzipped</name>
  <files>None (analysis only)</files>
  <action>
Build the site and analyze bundle size using rollup-plugin-visualizer.

```bash
# Clean build
rm -rf dist/

# Build site (generates stats.html)
pnpm run build

# Check total JavaScript bundle size
# Look for _astro/*.js files in dist/
ls -la dist/_astro/*.js 2>/dev/null || echo "No JS files in _astro (good for static)"

# Get gzipped size of all JS files
find dist -name "*.js" -exec gzip -c {} \; | wc -c
# Divide by 1024 for KB

# Alternative: check stats.html manually or extract from visualizer output
```

Target: Total gzipped JavaScript under 150KB

Expected breakdown (from research):
- Framer Motion: ~34KB gzipped
- React + React DOM: ~30KB gzipped
- Lucide icons (tree-shaken): ~5KB gzipped
- App code: ~10KB gzipped
- Total expected: ~79KB gzipped (well under 150KB)

If bundle exceeds 150KB, document the breakdown and identify optimization opportunities.
  </action>
  <verify>
```bash
# Build and measure
pnpm run build

# Calculate total JS size (gzipped)
total=0
for f in $(find dist -name "*.js" 2>/dev/null); do
  size=$(gzip -c "$f" | wc -c)
  echo "$f: $((size/1024))KB gzipped"
  total=$((total + size))
done
echo "Total: $((total/1024))KB gzipped"

# Verify under 150KB
if [ $((total/1024)) -lt 150 ]; then
  echo "PASS: Bundle under 150KB"
else
  echo "FAIL: Bundle exceeds 150KB"
fi
```
  </verify>
  <done>Bundle size verified under 150KB gzipped, breakdown documented in summary</done>
</task>

</tasks>

<verification>
```bash
# Full verification suite
pnpm run check   # TypeScript
pnpm run test    # Playwright (islands + SEO)
pnpm run build   # Build succeeds

# Visual verification
pnpm run dev &
sleep 3
echo "Visit http://localhost:4321/ to verify landing page"
# Should see: Navbar, Hero, Features, Waitlist, Footer
kill %1
```
</verification>

<success_criteria>
1. Landing page accessible at / with all sections visible
2. All Playwright tests pass (islands.spec.ts + seo.spec.ts)
3. isHomepage={true} enables JSON-LD schemas
4. Bundle size under 150KB gzipped
5. TypeScript check passes
6. Build succeeds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-landing-page-assembly/05-03-SUMMARY.md`
</output>
