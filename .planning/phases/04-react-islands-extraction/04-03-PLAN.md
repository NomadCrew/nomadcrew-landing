---
phase: 04-react-islands-extraction
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/components/react/WaitlistForm.tsx
  - src/components/Footer.astro
  - src/pages/test-waitlist.astro
autonomous: true

must_haves:
  truths:
    - "WaitlistForm renders with email input and submit button"
    - "WaitlistForm shows loading state when submitting"
    - "WaitlistForm shows success message after submission"
    - "WaitlistForm shows error state on failure"
    - "WaitlistForm shows validation error for invalid email format"
    - "Footer renders as static Astro component (no JS)"
  artifacts:
    - path: "src/components/react/WaitlistForm.tsx"
      provides: "Interactive waitlist signup form"
      exports: ["default"]
      min_lines: 80
    - path: "src/components/Footer.astro"
      provides: "Static footer component"
      min_lines: 5
  key_links:
    - from: "src/components/react/WaitlistForm.tsx"
      to: "/api/waitlist"
      via: "fetch POST"
      pattern: "fetch.*api/waitlist"
    - from: "src/components/react/WaitlistForm.tsx"
      to: "react"
      via: "useState hooks"
      pattern: "useState.*email|status|errorMessage"
---

<objective>
Extract WaitlistForm component and create static Footer.astro component.

Purpose: Extract the most interactive component (WaitlistForm with state management) and convert the simple Footer to a static Astro component with no JavaScript. This demonstrates the spectrum from full interactivity to zero JS.

Output:
- src/components/react/WaitlistForm.tsx (React island with client:visible)
- src/components/Footer.astro (static Astro component, no hydration)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-react-islands-extraction/04-RESEARCH.md
@src/LandingPage.tsx
@src/layouts/BaseLayout.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract WaitlistForm component</name>
  <files>src/components/react/WaitlistForm.tsx</files>
  <action>
Extract the Waitlist Form from src/LandingPage.tsx (lines 146-222) into a standalone React component with full state management.

The WaitlistForm includes:
1. useState for email, status ('idle'|'loading'|'success'|'error'), errorMessage
2. handleSubmit async function with fetch to /api/waitlist
3. motion.form with slide-up animation
4. Email input with disabled states
5. motion.button with conditional styling based on status
6. Loader2 icon for loading state
7. Error message display
8. Success message display

Requirements:
- Import useState from 'react'
- Import motion from 'framer-motion'
- Import Loader2 from 'lucide-react'
- Export as default function WaitlistForm()
- NO props needed (all handlers are internal)
- Keep the existing /api/waitlist endpoint path (Phase 6 will migrate the endpoint)
- Keep all form validation logic exactly as-is
- Keep all Tailwind classes for styling
- Include email format validation (must show error for invalid email format)

Important: The handleSubmit function is defined INSIDE the component, not passed as a prop. This is the correct pattern for Astro islands (functions cannot be serialized as props).

Pattern from research:
```tsx
import { useState } from 'react';
import { motion } from 'framer-motion';
import { Loader2 } from 'lucide-react';

export default function WaitlistForm() {
  const [email, setEmail] = useState('');
  const [status, setStatus] = useState<'idle' | 'loading' | 'success' | 'error'>('idle');
  const [errorMessage, setErrorMessage] = useState('');

  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault();

    // Email format validation
    if (!email || !email.includes('@')) {
      setStatus('error');
      setErrorMessage('Please enter a valid email address');
      return;
    }

    // ... existing logic from lines 24-58
  };

  return (
    <motion.form onSubmit={handleSubmit} ...>
      {/* form JSX from lines 160-211 */}
    </motion.form>
  );
}
```

Copy the complete form logic from lines 24-58 and JSX from lines 160-220.

Note: The section wrapper (lines 147-159, 221-222) will be added by the Astro page in Phase 5, not this component. This component is ONLY the form itself.
  </action>
  <verify>
1. File exists: ls src/components/react/WaitlistForm.tsx
2. TypeScript compiles: pnpm run check
3. Has all three useState: grep -c "useState" src/components/react/WaitlistForm.tsx (should be 3)
4. Has handleSubmit: grep -q "handleSubmit" src/components/react/WaitlistForm.tsx
5. Fetches API: grep -q "api/waitlist" src/components/react/WaitlistForm.tsx
6. Has email validation: grep -q "valid.*email\|@" src/components/react/WaitlistForm.tsx
  </verify>
  <done>
- WaitlistForm.tsx exists with useState for email, status, errorMessage
- handleSubmit function defined inside component
- Fetches /api/waitlist on submit
- Includes email format validation (shows error for invalid format)
- TypeScript check passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Create static Footer.astro component</name>
  <files>src/components/Footer.astro</files>
  <action>
Create a static Astro component for the Footer, removing Framer Motion animations.

The original Footer (lines 226-235) uses motion.footer with fade-in animation. Per the research analysis, Footer is a simple copyright text where animation is not critical. Converting to static Astro eliminates unnecessary JavaScript.

Requirements:
- NO imports (pure Astro component)
- Use standard HTML footer tag (not motion.footer)
- Keep all Tailwind classes: bg-gray-50 py-8
- Keep container structure: container mx-auto px-4 text-center text-gray-600
- Update copyright year to 2024 (matches source)
- NO client directive needed (static component)

```astro
---
// src/components/Footer.astro
// Static footer component - no JavaScript shipped
---

<footer class="bg-gray-50 py-8">
  <div class="container mx-auto px-4 text-center text-gray-600">
    <p>&copy; 2024 NomadCrew. All rights reserved.</p>
  </div>
</footer>
```

This demonstrates PERF-05: Static components use Astro (no JS shipped).
  </action>
  <verify>
1. File exists: ls src/components/Footer.astro
2. Is Astro file (not TSX): file src/components/Footer.astro
3. Has footer tag: grep -q "<footer" src/components/Footer.astro
4. No motion import: ! grep -q "motion" src/components/Footer.astro
  </verify>
  <done>
- Footer.astro exists as static Astro component
- Uses standard HTML footer (no motion)
- No JavaScript will be shipped for this component
  </done>
</task>

<task type="auto">
  <name>Task 3: Create test page for WaitlistForm</name>
  <files>src/pages/test-waitlist.astro</files>
  <action>
Create a test page to verify WaitlistForm renders and handles state correctly.

```astro
---
import BaseLayout from '../layouts/BaseLayout.astro';
import WaitlistForm from '../components/react/WaitlistForm.tsx';
import Footer from '../components/Footer.astro';
---

<BaseLayout
  title="Waitlist Test"
  description="Testing WaitlistForm component in isolation"
>
  <!-- Spacer for visual context -->
  <div class="pt-24 pb-8 px-4 text-center">
    <h1 class="text-2xl font-bold">Waitlist Form Test</h1>
    <p class="text-gray-600 mt-2">Test form states: idle, loading, success, error</p>
  </div>

  <!-- Waitlist section mimicking real usage -->
  <section id="waitlist" class="py-16 px-4">
    <div class="container mx-auto max-w-xl text-center">
      <h2 class="text-3xl font-bold mb-6">Join the Waitlist</h2>
      <p class="text-gray-600 mb-8">
        Be among the first to experience a better way to travel together.
        Get early access and exclusive updates.
      </p>
      <WaitlistForm client:visible />
    </div>
  </section>

  <!-- Footer to test static component -->
  <Footer />

  <div class="py-8 text-center text-gray-500 text-sm">
    <p>Note: Form submits to /api/waitlist which may not exist yet.</p>
    <p>Test cases:</p>
    <ul class="mt-2 space-y-1">
      <li>1. Submit empty form - should show "Please enter your email"</li>
      <li>2. Submit "invalid" (no @) - should show validation error</li>
      <li>3. Submit valid email - should show loading then success/error</li>
    </ul>
  </div>
</BaseLayout>
```

Uses client:visible because the waitlist form is typically in the middle of the page and can hydrate when scrolled into view.

Also includes Footer to verify static component renders without hydration.
  </action>
  <verify>
1. File exists: ls src/pages/test-waitlist.astro
2. Page loads: pnpm run dev, then curl http://localhost:4321/test-waitlist/
3. Footer included: grep -q "Footer" src/pages/test-waitlist.astro
  </verify>
  <done>
- test-waitlist.astro exists
- Page accessible at /test-waitlist/
- WaitlistForm renders with client:visible
- Footer renders as static component
- Test instructions included for validation testing
  </done>
</task>

</tasks>

<verification>
Run complete verification sequence:

```bash
# 1. Check all files exist
ls -la src/components/react/WaitlistForm.tsx src/components/Footer.astro

# 2. TypeScript validation
pnpm run check

# 3. Verify WaitlistForm has state management
grep -c "useState" src/components/react/WaitlistForm.tsx

# 4. Verify Footer has no JavaScript
! grep -q "import" src/components/Footer.astro && echo "Footer is pure static"

# 5. Test page exists and loads
pnpm run dev &
sleep 3
curl -s http://localhost:4321/test-waitlist/ | grep -q "Waitlist Form Test" && echo "Page OK"
```

Manual verification (recommended):
1. Open http://localhost:4321/test-waitlist/
2. Try submitting empty form - should show "Please enter your email"
3. Enter "invalid" (no @) - should show validation error for invalid email format
4. Enter valid email - see loading state (spinner)
5. Form may error if API not available - that's expected for Phase 4
6. Check browser console - no hydration errors
7. Verify Footer renders without any hydration (view source, no script tags for Footer)
</verification>

<success_criteria>
1. WaitlistForm.tsx exists with useState for email, status, errorMessage
2. WaitlistForm.tsx has handleSubmit that fetches /api/waitlist
3. WaitlistForm.tsx validates email format (shows error for invalid format like "test" without @)
4. Footer.astro exists as pure Astro component (no imports, no motion)
5. pnpm run check passes without errors
6. /test-waitlist/ renders form with visible input and button
7. Form shows "Please enter your email" when submitting empty
8. Form shows validation error for invalid email format
9. No hydration mismatch errors in browser console
</success_criteria>

<output>
After completion, create `.planning/phases/04-react-islands-extraction/04-03-SUMMARY.md`
</output>
