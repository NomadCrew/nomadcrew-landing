---
phase: 01-foundation-setup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - astro.config.mjs
autonomous: true

must_haves:
  truths:
    - "Astro dev server starts without errors"
    - "npm run dev launches Astro on port 4321"
    - "Coexistence scripts preserved for fallback"
  artifacts:
    - path: "astro.config.mjs"
      provides: "Astro configuration with React integration"
      min_lines: 15
    - path: "package.json"
      provides: "Updated scripts for Astro and Vite coexistence"
      contains: "astro dev"
  key_links:
    - from: "package.json"
      to: "astro.config.mjs"
      via: "npm scripts invoke astro CLI"
      pattern: "astro dev|astro build"
    - from: "astro.config.mjs"
      to: "@astrojs/react"
      via: "integrations array"
      pattern: "integrations.*react"
---

<objective>
Install Astro 5.x packages and create astro.config.mjs with React integration.

Purpose: Establishes the Astro framework as the primary build tool while maintaining Vite scripts for coexistence during migration. React integration enables island architecture for existing components.

Output: Astro installed with working dev server, config file ready for Tailwind plugin (added in Plan 04).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-setup/01-RESEARCH.md

# Current package.json scripts (to be updated):
# "dev": "vite"
# "build": "tsc -b && vite build && cp -r .well-known dist/"
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Astro core packages</name>
  <files>package.json</files>
  <action>
Install Astro packages using npm:

```bash
npm install astro@^5.16.16 @astrojs/react@^4.4.2
npm install --save-dev @astrojs/check
```

Packages installed:
- astro@^5.16.16: Core framework (includes Vite 6 internally)
- @astrojs/react@^4.4.2: React integration for islands
- @astrojs/check: TypeScript checking for .astro files (dev dependency)

Note: Do NOT remove existing packages. Coexistence requires keeping:
- vite, @vitejs/plugin-react (for dev:vite fallback)
- react, react-dom (used by Astro React integration)
- All Tailwind packages (Tailwind plugin added in Plan 04)
  </action>
  <verify>
Run: `npm list astro @astrojs/react @astrojs/check` - all three packages listed
Run: `npx astro --version` - shows Astro version
  </verify>
  <done>
- astro@^5.16.16 appears in package.json dependencies
- @astrojs/react@^4.4.2 appears in package.json dependencies
- @astrojs/check appears in package.json devDependencies
- npm install completes without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Create astro.config.mjs and update scripts</name>
  <files>astro.config.mjs, package.json</files>
  <action>
1. Create astro.config.mjs at project root:

```javascript
// astro.config.mjs
import { defineConfig } from 'astro/config';
import react from '@astrojs/react';

// https://astro.build/config
export default defineConfig({
  site: 'https://nomadcrew.uk',

  // Static site generation (not SSR)
  output: 'static',

  // React integration for islands
  integrations: [
    react({
      include: ['**/react/*', '**/*.tsx'],
    }),
  ],

  // Vite configuration - Tailwind plugin added in Plan 04
  vite: {
    plugins: [],
  },

  // Dev server configuration
  server: {
    port: 4321,
    host: true,
  },
});
```

2. Update package.json scripts for coexistence:

```json
{
  "scripts": {
    "dev": "astro dev",
    "dev:vite": "vite",
    "build": "astro build",
    "build:vite": "tsc -b && vite build",
    "preview": "astro preview",
    "check": "astro check",
    "lint": "eslint ."
  }
}
```

Script changes:
- "dev" now runs Astro (port 4321)
- "dev:vite" preserved for fallback to original Vite server
- "build" now runs Astro build
- "build:vite" preserved without .well-known copy (moved to public/)
- "preview" now previews Astro build
- "check" added for TypeScript verification
- "lint" unchanged

Note: The cp command is removed from build:vite because .well-known is now in public/ (Plan 01).
  </action>
  <verify>
Run: `cat astro.config.mjs` - file exists with correct content
Run: `npm run dev` - Astro dev server starts on port 4321 (Ctrl+C to stop)
Run: `npm run dev:vite` - Vite fallback still works (Ctrl+C to stop)
  </verify>
  <done>
- astro.config.mjs exists with defineConfig, react integration, static output
- package.json has all 7 scripts: dev, dev:vite, build, build:vite, preview, check, lint
- "npm run dev" starts Astro on port 4321
- "npm run dev:vite" starts Vite on port 5173 (coexistence works)
  </done>
</task>

</tasks>

<verification>
1. Packages installed: `npm list astro @astrojs/react @astrojs/check`
2. Config exists: `cat astro.config.mjs | head -20`
3. Scripts updated: `cat package.json | grep -A10 '"scripts"'`
4. Dev server works: `npm run dev` starts without errors (test manually)
</verification>

<success_criteria>
- Astro 5.16.16+ installed and working
- @astrojs/react integration configured
- Dev server accessible at localhost:4321
- Vite fallback preserved via dev:vite script
- No breaking changes to existing React code
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup/01-02-SUMMARY.md`
</output>
